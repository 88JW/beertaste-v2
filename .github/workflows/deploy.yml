name: Deploy to Home Server

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: self-hosted
    steps:
      - name: Pobranie kodu
        uses: actions/checkout@v4

      - name: Zbudowanie obrazu (Pude≈Çka)
        # Budujemy obraz i nazywamy go beertaste-v2:latest
        run: docker build -t beertaste-v2:latest ./client

      - name: Instalacja sterownika w folderze Projects
        # Kopiujemy nasz plik prod.yml do folderu na serwerze jako docker-compose.yml
        run: cp docker-compose.prod.yml ~/projects/beertaste-v2/docker-compose.yml

      - name: Uruchomienie z folderu Projects
        # Wchodzimy do folderu projects/beertaste-v2 i odpalamy
        working-directory: /home/wojciech/projects/beertaste-v2
        run: |
          docker compose up -d --force-recreate