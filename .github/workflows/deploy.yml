name: Deploy to Home Server

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: self-hosted
    steps:
      - name: Czyszczenie przestrzeni roboczej
        run: rm -rf ./* || true

      - name: Pobranie kodu
        uses: actions/checkout@v4

      - name: Zbudowanie obrazu
        run: docker build -t beertaste-v2:latest ./client

      - name: Instalacja sterownika w folderze Projects
        # ðŸ‘‡ ZMIANA: UÅ¼ywamy peÅ‚nej Å›cieÅ¼ki /home/wojciech/...
        run: cp docker-compose.prod.yml /home/wojciech/projects/beertaste-v2/docker-compose.yml

      - name: Uruchomienie z folderu Projects
        # ðŸ‘‡ ZMIANA: Tutaj teÅ¼ peÅ‚na Å›cieÅ¼ka
        working-directory: /home/wojciech/projects/beertaste-v2
        run: |
          docker compose down || true
          docker compose up -d --force-recreate